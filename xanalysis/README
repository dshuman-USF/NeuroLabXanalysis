--------------------------------------------------------------------------------
Sat Nov  6 10:21:29 EDT 2010

CYCLE DURATION SELECTIONS
=========================

After you choose the range of cycle durations, Ti's, and Te's that
will be used to calculate respiratory CTH's (by clicking on the
distribution histograms), xanalysis will save your choices in a file.
The name of the file is the base filename of the datasave file
followed by "_minmax.txt", and it is written to the x2000 directory.

If this file exists before the ranges are chosen, xanalysis will read
the values from it and use them as your initial choices.  The
histograms will be displayed with these choices, and you can change
them if desired.  The final choices will be written over the original
contents of the file.

This makes it possible to precisely recreate the same xanalysis
results from the original data, should it ever be necessary to do so.


PARALLEL COMPUTATION OF THE SURROGATE CONTROL
=============================================

Multiple processors can be used to generate surrogates in parallel.
To set this up, lines of the form

hostname slots=N

should be added to the file /etc/openmpi/openmpi-default-hostfile,
where "hostname" is the name of a computer and N is the maximum number
of processors to use on that computer.  The user will choose the
actual numbers each time he runs xanalysis.  If this file is not set
up, only localhost will be used for the parallel computation, and the
user will be able to use up to all the processors on the local host.

When xanalysis runs, it will set up secure password-less login over
ssh for each of the hosts in openmpi-default-hostfile (or for
localhost) if it is not already set up.  The user will be asked for
his password for this purpose, and in order for this to work well, his
password should be the same for all the hosts, because it is only
asked-for once.  If necessary, the user could run xanalysis once for
each password if there is more than one.  Or the user could run
"setup_passwordless_login" directly (it's normally invoked by
xanalysis) with one or more hostnames as arguments, once for each
password.

For the parallel computation to work, the packages openmpi-bin,
openssh-server, openssh-client, and expect must be installed, even
though xanalysis can be compiled without them (however, libopenmpi-dev
must be installed to compile).  On a system that uses apt-get (like
Debian and Ubuntu), xanalysis will install these packages
automatically when xanalysis is installed (by "make install"), if they
are not already installed.

When more than one host is used for the parallel computation, the
working directory must be on a shared disk, and the path to the
working directory must be the same on all hosts, and on the host
running xanalysis, it must be the real path, with no symbolic links.

TYPES OF CORRELATION AND CONTROLS
=================================

Correlations are caused by covariations in rate.  This is sometimes
distinguished from spike synchrony, but by considering the position of
a spike in a time frame that is small relative to the ISI to be caused
by a variation in rate that is fast relative to the ISI, we include
spike synchrony (spikes that tend to be coincident in a window that is
small relative to the ISI) as a correlation caused by a covariation in
rate.

We can classify firing rate modulations in three different ways:

1. respiratory or not

2. fast or slow relative the the spike train's ISI

3. fast or slow relative to the respiratory rhythm

There are 6 possibilities:

   resp    wrt ISI     wrt resp  shift  PBM   Feature
   ----    -------     --------  -----  ---   -------
1. resp    fast          =               X
2. resp    slow          =
3. nrm     fast        fast       +      +     +
4. nrm     fast        slow       X      X     
5. nrm     slow        fast       +            +
6. nrm     slow        slow       X

A shift control follows, and therefore controls for, respiratory
modulations, so the other 4 types of modulations show up as features,
as shown in the "shift" column of the table (+ is desired, X is not).

The Pauluis-Baker-Miura (PBM) surrogate follows, and therefore
controls for, rate modulations that are slow compared to the ISI, so
the other three types of modulation show up as features, as shown in
the PBM column of the table.

Of the 6 types of rate modulation, there are only two that generate
what we want to consider features.

We don't want to consider correlations generated by respiratory
modulations to be features.  The shift control is good here.  The PBM
surrogate is good unless the cell is firing less than about once per
cycle.

We don't want to consider correlations that are caused by rate
modulations that are slower than the respiratory cycle to be
features.  We call these non-stationarities.  The PBM surrogate is
good here unless the cell is firing much less than once per cycle.
The shift control, though, will make these correlations look like
features.

Correlations that are caused by rate modulations that are fast
compared to the ISI and the respiratory rhythm we do want to consider
features, and both controls will pick these out.

Correlations that are caused by rate modulations that are slow
compared to the ISI and fast compared to the respiratory rhythm we do
want to consider features, but only the shift control will pick these
out.

If we drop slow spike trains, there are two remaining cases where the
controls give different results.  In one, the shift control gives a
spurious feature, and in the other, the PBM surrogate misses a real
feature.

SURROGATE CONTROL PLOTS
================================================================================

A bin is marked significant with a red square if all the surrogate CCH
values for that bin were on the same side of the original data CCH
value for the bin.  Surrogate CCHs are generated until there are
enough to keep the False Discovery Rate (FDR) below 5%.  This
necessary number is the same for every CCH in the experiment, and is
displayed as N in a message of the form "no straddle at N" if there
was at least one significant bin in the CCHs of the cell pair.  If the
min and max values of the surrogate CCHs straddle the data CCH
value in every bin of a pair before N surrogate CCHs are generated,
then there are no significant bins for that cell pair and the message
will be of the form "straddle at M/N", where M is the number of
surrogate CCHs at which all the bins were straddled.

The surrogate control "confidence limit" are actually the min and max
values of the surrogate CCHs for each bin.

SURROGATE CONTROL FOR STATS
================================================================================

As of version 6.7.11, xanalysis will use the surrogate control instead
of the CTH control for the stats calculation if the surrogate control
is available.

NOHUP MODE
================================================================================

xanalysis can take a long time to compute the cross-correlations and
the surrogates, and you may not wish to be logged in the whole time,
or your connection to the system may not be stable enough to stay up
for the whole time.  For this purpose, xanalysis offers nohup mode, as
of version 6.9.0.  To use it, run xanalysis_nohup instead of
xanalysis.  It will work just like the ordinary xanalysis, except that
after you have answered yes to the question

  LAST U-TURN BEFORE HISTOGRAM FILE IS CREATED.  CONTINUE? (y/n)  >> 

you will see the line

  autoexpect done, file is script.exp

and then you will get your command prompt back.  It will look like
xanalysis has exited, but actually it is running in the background, as
you can verify by running the command

  pgrep xanalysis

which will respond with a number representing the process ID if
xanalysis is running.  The output that would have appeared on the
screen will be sent to a file named nohup.out, and you can watch the
output with the command

  tail -f nohup.out

You can stop watching nohup.out by typing Ctrl-C.

When you get your command prompt back, you can log out and xanalysis
will continue to run until it is done.  The last thing in nohup.out
when it is done should be the main xanalysis menu with an 'x' at the
prompt.

If you answer no to the U-TURN question, xanalysis_nohup will exit as
before, with the same message, but it will not be running in the
background.  It will have created files named "script.exp" and
"x2000/*_minmax.txt". You can edit these files if you want to, and you
can run them at a later time with the command

  xanalysis_run_script

and it will then run in the background to completion just as if you
had answered yes to the U-TURN question.

Caveats
-------

When running xanalysis_nohup, you must answer no to the following two
questions:

  Do you want to import a coordinate/AA/STA/comment info data file?  (y/n)  >> 
  Do you want to import a response-to-perturbation data file?  (y/n)  >> 

Also, when you run xanalysis_nohup, you will not have an opportunity
to specify the number of slots to use on each host.  Instead, it will
run with the maximum number specified in
/etc/openmpi/openmpi-default-hostfile for each host.  You can specify
smaller numbers by answering no to the U-TURN question and editing the
script.exp file.  Instructions for doing so will be near the bottom of
script.exp.

